const e=()=>{let e=[];return Object.freeze({listen:n=>{const t=e=>{n(e)};return e.push(t),{unsubscribe:()=>{e=e.filter((e=>t!==e))}}},emit:n=>{e.forEach((e=>e({value:n})))}})};function n(e){return"string"==typeof e?[e]:Array.isArray(e)?e:void 0}function t(e){return n(e)||[]}function a(e,n){return"object"!=typeof(a=n)||Array.isArray(a)||null===a?t(n):t(null==n?void 0:n[e]);var a}function i(e){return Array.from(new Set(e))}function o(e,n){const t=e.get(n)||0;e.set(n,t+1)}function r(e,n){let t=e.get(n)||1;t-=1,t<=0?e.delete(n):e.set(n,t)}const s=e=>{const n=new Set,a=new Set,i=n=>{if(n.has(void 0)){const t=new Set(n.keys());return t.delete(void 0),e().forEach((e=>t.add(e))),t}return n};let s=[];const g=()=>{if(0===s.length)return;n.forEach((e=>{e({value:void 0})}));const e=new Set;let t=new Set;s.forEach((n=>{void 0===(null==n?void 0:n.ns)?e.add(void 0):n.ns.forEach((n=>e.add(n))),void 0===(null==n?void 0:n.key)?t=void 0:void 0!==t&&t.add(n.key)}));const o=Array.from(i(e).keys());(t||[void 0]).forEach((e=>{((e,n)=>{a.forEach((t=>{const a=i(t.namespaces),o=void 0===n||-1!==(null==n?void 0:n.findIndex((e=>a.has(e)))),r=void 0===e||t.keys.has(e)||0===t.keys.size;o&&r&&t.fn({value:void 0})}))})(e,o)})),s=[]};return Object.freeze({listenSome:e=>{const n={fn:n=>{e(n)},keys:new Map,namespaces:new Map};a.add(n);const i={unsubscribe:()=>{a.delete(n)},subscribeNs:e=>(t(e).forEach((e=>o(n.namespaces,e))),i),unsubscribeNs:e=>(t(e).forEach((e=>r(n.namespaces,e))),i),subscribeKey:e=>{const{key:a,ns:r}=e;return o(n.keys,a),t(r).forEach((e=>o(n.namespaces,e))),void 0===r&&o(n.namespaces,void 0),i},unsubscribeKey:e=>{const{key:a,ns:o}=e;return r(n.keys,a),t(o).forEach((e=>r(n.namespaces,e))),void 0===o&&r(n.namespaces,void 0),i}};return i},listen:e=>{n.add(e);return{unsubscribe:()=>{n.delete(e)}}},emit:(e,n)=>{s.push(e),n?Promise.resolve().then((()=>{g()})):g()}})},g=e=>{const n=new Map;return Object.entries(e).forEach((([e,t])=>{null!=t&&("object"!=typeof t?n.set(e,t):g(t).forEach(((t,a)=>{n.set(e+"."+a,t)})))})),n},c=e=>{const[n,t]=e.split(":");return{language:n,namespace:t||""}},u=({language:e,namespace:n})=>n?`${e}:${n}`:e,l=(e,n,a,i,o,r,s)=>{const l=new Map,d=new Map;let f={},p=0;function v(n,t,a){const i=u(n);d.set(i,{data:g(t),version:a}),e.emit(n)}function h(e,n){v(e,n,p)}function b(e,n=!1){const t=d.get(u(e));return t&&n?t.version===p:Boolean(t)}function m(e){var n;return null===(n=d.get(u(i(e))))||void 0===n?void 0:n.data}function E(e){let t;if(!t){const n=f[u(e)];"function"==typeof n&&(t=n())}return t||(t=n(e)),t||(t=Promise.resolve({})),t}return Object.freeze({addStaticData:function(e){e&&(f=Object.assign(Object.assign({},f),e),Object.entries(e).forEach((([e,n])=>{if("function"!=typeof n){const t=c(e),a=d.get(e);a&&0!==a.version||v(t,n,0)}})))},invalidate:function(){l.clear(),p+=1},addRecord:h,exists:b,getRecord:m,getTranslation:function(e,n){var t;return null===(t=d.get(u(e)))||void 0===t?void 0:t.data.get(n)},getTranslationNs:function(e,n,t){var a;for(const i of e)for(const e of n){const n=null===(a=d.get(u({language:e,namespace:i})))||void 0===a?void 0:a.data.get(t);if(null!=n)return i}return Array.from(new Set(e))},getTranslationFallback:function(e,n,t){var a;for(const i of e)for(const e of n){const n=null===(a=d.get(u({language:e,namespace:i})))||void 0===a?void 0:a.data.get(t);if(null!=n)return n}},changeTranslation:function(n,t,a){var i;const o=null===(i=d.get(u(n)))||void 0===i?void 0:i.data;null==o||o.set(t,a),e.emit(Object.assign(Object.assign({},n),{key:t}))},isFetching:function(e){if(o())return!0;if(void 0===e)return l.size>0;const n=t(e);return Boolean(Array.from(l.keys()).find((e=>n.includes(c(e).namespace))))},isLoading:function(e,n){const a=t(n);return Boolean(o()||Array.from(l.keys()).find((n=>{const t=c(n);return(!a.length||a.includes(t.namespace))&&!b({namespace:t.namespace,language:e})})))},loadRecords:async function(e,n){const t=e.map((e=>{const t=i(e),o=u(t),r=l.get(o);if(r)return{new:!1,promise:r,keyObject:t,cacheKey:o};const s=function(e,n){var t;let i;return n&&(i=null===(t=a(e))||void 0===t?void 0:t.catch((()=>(console.warn("Tolgee: Failed to fetch data from dev backend"),E(e))))),i||(i=E(e)),i}(t,n);return l.set(o,s),{new:!0,promise:s,keyObject:t,cacheKey:o}}));r.notify(),s.notify();const o=await Promise.all(t.map((e=>e.promise)));return t.forEach(((e,n)=>{const t=l.get(e.cacheKey)!==e.promise;if(e.new&&!t){l.delete(e.cacheKey);const t=o[n];t&&h(e.keyObject,t)}})),r.notify(),s.notify(),t.map((e=>m(e.keyObject)))},getAllRecords:function(){return Array.from(d.entries()).map((([e,n])=>Object.assign(Object.assign({},c(e)),{data:n.data})))}})};function d(e){return Boolean(e&&"function"==typeof e.then)}const f=(e,n)=>d(e)?Promise.resolve(e).then(n):n(e),p=e=>`Tolgee: You need to specify '${e}' option`,v=(e,n,a,i,o,r,s)=>{const g={ui:void 0,observer:void 0},c={formatters:[],finalFormatter:void 0,observer:void 0,devBackend:void 0,backends:[],ui:void 0,languageDetector:void 0,languageStorage:void 0},u=async(e,{keysAndDefaults:n})=>{var a;const i=n.map((({key:e,ns:n,defaultValue:a})=>({key:e,defaultValue:a,ns:t(o({key:e,ns:n,defaultValue:a})),translation:r({key:e,ns:n})})));null===(a=c.ui)||void 0===a||a.handleElementClick(e,i)},l=(e,n)=>{var t,a;return(null===(a=null===(t=c.observer)||void 0===t?void 0:t.highlight)||void 0===a?void 0:a.call(t,e,n))||{unhighlight(){}}},p=e=>{const n=r(e);return v(Object.assign(Object.assign({},e),{translation:n,formatEnabled:!0}))},v=({key:n,translation:t,defaultValue:a,noWrap:i,params:o,orEmpty:r,ns:s,formatEnabled:g})=>{var u;const l=t||a;let d=l||(r?"":n);c.observer&&!i&&(d=c.observer.wrap({key:n,translation:d,defaultValue:a,params:o,ns:s}));const f=e(),p=g||!(null===(u=c.observer)||void 0===u?void 0:u.outputNotFormattable);if(l&&f&&p)for(const e of c.formatters)d=e.format({translation:d,language:f,params:o});return c.finalFormatter&&l&&f&&p&&(d=c.finalFormatter.format({translation:d,language:f,params:o})),d};return Object.freeze({setFinalFormatter:e=>{c.finalFormatter=e},addFormatter:e=>{e&&c.formatters.push(e)},formatTranslation:v,setObserver:e=>{g.observer=e},hasObserver:()=>Boolean(g.observer),setUi:e=>{g.ui=(null==e?void 0:e.UI)||e},hasUi:()=>Boolean(g.ui),addBackend:e=>{e&&c.backends.push(e)},setDevBackend:e=>{c.devBackend=e},getDevBackend:()=>c.devBackend,getBackendRecord:({language:e,namespace:n})=>{for(const t of c.backends){const a=t.getRecord({language:e,namespace:n});if(d(a))return null==a?void 0:a.catch((e=>(console.error(e),{})));if(void 0!==a)return a}},getBackendDevRecord:({language:e,namespace:t})=>{var a;return null===(a=c.devBackend)||void 0===a?void 0:a.getRecord({apiKey:n().apiKey,apiUrl:n().apiUrl,language:e,namespace:t})},setLanguageDetector:e=>{c.languageDetector=e},getLanguageDetector:()=>c.languageDetector,setLanguageStorage:e=>{c.languageStorage=e},getLanguageStorage:()=>c.languageStorage,getInitialLanguage:()=>{var e;const n=i(),t=null===(e=c.languageStorage)||void 0===e?void 0:e.getLanguage();return f(t,(e=>n&&!n.includes(e)||!e?(()=>{if(!c.languageDetector)return;const e=i();return c.languageDetector.getLanguage({availableLanguages:e})})():e))},setStoredLanguage:e=>{var n;null===(n=c.languageStorage)||void 0===n||n.setLanguage(e)},run:e=>{var t,i;!c.ui&&g.ui&&(c.ui=new g.ui({apiKey:n().apiKey,apiUrl:n().apiUrl,highlight:l,changeTranslation:s})),c.observer||(c.observer=null===(t=g.observer)||void 0===t?void 0:t.call(g,{translate:p,onClick:u,options:a()})),null===(i=c.observer)||void 0===i||i.run({mouseHighlight:e})},stop:()=>{var e;c.ui=void 0,null===(e=c.observer)||void 0===e||e.stop()},retranslate:()=>{var e;null===(e=c.observer)||void 0===e||e.retranslate()},highlight:l,wrap:e=>{var n;return c.observer?null===(n=c.observer)||void 0===n?void 0:n.wrap(e):e.translation},unwrap:e=>{var n;return c.observer?null===(n=c.observer)||void 0===n?void 0:n.unwrap(e):{text:e,keys:[]}}})},h=(e,n,t)=>{let a=e;return Object.freeze({init:function(e){a=e},notify:function(){const e=n();a!==e&&t(e),a=e}})},b={tagAttributes:{textarea:["placeholder"],input:["value","placeholder"],img:["alt"],"*":["aria-label","title"]},restrictedElements:["script","style"],highlightKeys:["Alt"],highlightColor:"rgb(255, 0, 0)",highlightWidth:5,inputPrefix:"%-%tolgee:",inputSuffix:"%-%",passToParent:["option","optgroup"]},m=e=>Object.assign(Object.assign({},b),e),E={defaultNs:""},y=(e,n)=>{const t=Object.assign(Object.assign(Object.assign({},E),null==n?void 0:n.initialOptions),e),a=t.apiUrl;return t.apiUrl=a?a.replace(/\/+$/,""):a,{initialOptions:t,activeNamespaces:(null==n?void 0:n.activeNamespaces)||new Map,language:null==n?void 0:n.language,pendingLanguage:null==n?void 0:n.language,isInitialLoading:!1,isRunning:!1}};function O(e){var{ns:n,noWrap:t,orEmpty:a,params:i}=e,o=function(e,n){var t={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&n.indexOf(a)<0&&(t[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)n.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(t[a[i]]=e[a[i]])}return t}(e,["ns","noWrap","orEmpty","params"]);return{ns:n,noWrap:t,orEmpty:a,params:Object.assign(Object.assign({},o),i)}}const L=(e,...n)=>{let t,a={};return"object"==typeof e?a=e:(a.key=e,"string"==typeof n[0]?(a.defaultValue=n[0],t=n[1]):"object"==typeof n[0]&&(t=n[0])),t&&(a=Object.assign(Object.assign({},O(t)),a)),a},A=({options:n})=>{const o=(n=>{const t=e(),a=e(),i=e(),o=e(),r=e(),g=e(),c=s(n),u=e(),l=e();return g.listen((()=>c.emit())),a.listen((()=>c.emit())),u.listen((({value:e})=>{c.emit({ns:[e.namespace],key:e.key},!0)})),Object.freeze({onPendingLanguageChange:t,onLanguageChange:a,onKeyChange:i,onKeyUpdate:c,onLoadingChange:o,onFetchingChange:r,onInitialLoaded:g,onRunningChange:l,onCacheChange:u,on:(e,n)=>{switch(e){case"pendingLanguage":return t.listen(n);case"language":return a.listen(n);case"loading":return o.listen(n);case"fetching":return r.listen(n);case"initialLoad":return g.listen(n);case"running":return l.listen(n);case"cache":return u.listen(n);case"keyUpdate":return c.listen(n)}}})})((function(){return u.getFallbackNamespaces()})),r=h(!1,(()=>E.isFetching()),o.onFetchingChange.emit),g=h(!1,(()=>k()),o.onLoadingChange.emit),u=((e,n,o)=>{let r,s=y(),g=m();function u(){return s.language||s.initialOptions.language}function l(){return Object.assign(Object.assign({},s.initialOptions),r)}return Object.freeze({init:function(e){s=y(e,s)},isRunning:function(){return s.isRunning},setRunning:function(e){s.isRunning!==e&&(s.isRunning=e,o.emit(e))},isInitialLoading:function(){return s.isInitialLoading},setInitialLoading:function(e){s.isInitialLoading=e},getLanguage:u,setLanguage:function(n){s.language!==n&&(s.language=n,e.emit(n))},getPendingLanguage:function(){return s.pendingLanguage||u()},setPendingLanguage:function(e){s.pendingLanguage!==e&&(s.pendingLanguage=e,n.emit(e))},getInitialOptions:l,addActiveNs:function(e){t(e).forEach((e=>{const n=s.activeNamespaces.get(e);void 0!==n?s.activeNamespaces.set(e,n+1):s.activeNamespaces.set(e,1)}))},removeActiveNs:function(e){t(e).forEach((e=>{const n=s.activeNamespaces.get(e);void 0!==n&&n>1?s.activeNamespaces.set(e,n-1):s.activeNamespaces.delete(e)}))},getRequiredNamespaces:function(){return i([...s.initialOptions.ns||[s.initialOptions.defaultNs],...s.activeNamespaces.keys()])},getFallbackLangs:function(e){const n=e||u();return n?i([n,...a(n,s.initialOptions.fallbackLanguage)]):[]},getFallbackNamespaces:function(){const e=s.initialOptions.defaultNs;return i([..."string"==typeof e?[e]:[],...t(s.initialOptions.fallbackNs)])},getAvailableLanguages:function(){if(s.initialOptions.availableLanguages)return s.initialOptions.availableLanguages;if(s.initialOptions.staticData){const e=Object.keys(s.initialOptions.staticData).map((e=>c(e).language));return Array.from(new Set(e))}},withDefaultNs:function(e){return{namespace:void 0===e.namespace?l().defaultNs:e.namespace,language:e.language}},overrideCredentials:function(e){r=e},setObserverOptions:function(e){g=m(e)},getObserverOptions:function(){return g}})})(o.onLanguageChange,o.onPendingLanguageChange,o.onRunningChange),b=v(u.getLanguage,u.getInitialOptions,u.getObserverOptions,u.getAvailableLanguages,(function({key:e,ns:n}){const a=void 0!==n?t(n):u.getFallbackNamespaces(),i=u.getFallbackLangs();return E.getTranslationNs(a,i,e)}),P,O),E=l(o.onCacheChange,b.getBackendRecord,b.getBackendDevRecord,u.withDefaultNs,u.isInitialLoading,r,g);function O(e,n,t){const a=u.withDefaultNs(e),i=E.getTranslation(a,n);return E.changeTranslation(a,n,t),{revert:()=>{E.changeTranslation(a,n,i)}}}function A(e){u.init(e),E.addStaticData(u.getInitialOptions().staticData)}function k(e){return E.isLoading(u.getLanguage(),e)}function R(){return Boolean(u.getInitialOptions().apiKey&&u.getInitialOptions().apiUrl&&b.getDevBackend())}function T(e,n){const a=function(e,n){const a=u.getFallbackLangs(e),i=void 0!==n?t(n):u.getRequiredNamespaces(),o=[];return a.forEach((e=>{i.forEach((n=>{E.exists({language:e,namespace:n},!0)||o.push({language:e,namespace:n})}))})),o}(e,n);if(a.length)return f(j(a),(()=>{}))}function P({key:e,ns:n}){const a=void 0!==n?t(n):u.getFallbackNamespaces(),i=u.getFallbackLangs();return E.getTranslationFallback(a,i,e)}function w(){const e=f(function(){if(u.getLanguage())return;if(!u.getInitialOptions().defaultLanguage)throw new Error(p("defaultLanguage"));const e=b.getInitialLanguage();return f(e,(e=>{const n=e||u.getInitialOptions().defaultLanguage;n&&u.setLanguage(n)}))}(),(()=>T()));if(d(e))return u.setInitialLoading(!0),r.notify(),g.notify(),Promise.resolve(e).then((()=>{u.setInitialLoading(!1),r.notify(),g.notify(),o.onInitialLoaded.emit()}));o.onInitialLoaded.emit()}function j(e){return E.loadRecords(e,R())}n&&A(n),o.onKeyUpdate.listen((()=>{u.isRunning()&&b.retranslate()}));return Object.freeze(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o),u),b),E),{init:A,changeLanguage:async function(e){u.getPendingLanguage()===e&&u.getLanguage()===e||(u.setPendingLanguage(e),u.isRunning()&&await T(e),e===u.getPendingLanguage()&&(u.setLanguage(e),b.setStoredLanguage(e)))},getTranslation:P,changeTranslation:O,addActiveNs:async function(e,n){n||u.addActiveNs(e),u.isRunning()&&await T(void 0,e)},loadRequiredRecords:T,loadRecords:j,loadRecord:async function(e){return(await j([e]))[0]},isLoading:k,isLoaded:function(e){const n=u.getLanguage();if(!n)return!1;const a=u.getFallbackLangs(n),i=void 0!==e?t(e):u.getRequiredNamespaces(),o=[];return a.forEach((e=>{i.forEach((n=>{E.exists({language:e,namespace:n})||o.push({language:e,namespace:n})}))})),0===o.length},t:(...e)=>{const n=L(...e),t=P(n);return b.formatTranslation(Object.assign(Object.assign({},n),{translation:t}))},isDev:R,run:function(){let e;return(()=>{const e=b.getLanguageDetector();if(e&&!u.getAvailableLanguages())throw new Error(p("availableLanguages"));if(!u.getLanguage()&&!u.getInitialOptions().defaultLanguage)throw e?new Error(p("defaultLanguage")):new Error(p("language"))})(),u.isRunning()||(R()&&E.invalidate(),u.setRunning(!0),b.run(R()),e=w()),Promise.resolve(e)},stop:function(){u.isRunning()&&(b.stop(),u.setRunning(!1))}}))},k=e=>{const n=A({options:e}),t=Object.freeze({setFinalFormatter:n.setFinalFormatter,addFormatter:n.addFormatter,setObserver:n.setObserver,hasObserver:n.hasObserver,setUi:n.setUi,hasUi:n.hasUi,setDevBackend:n.setDevBackend,addBackend:n.addBackend,setLanguageDetector:n.setLanguageDetector,setLanguageStorage:n.setLanguageStorage,overrideCredentials:n.overrideCredentials}),a=e=>{const t=n.isRunning();t&&n.stop(),e(),t&&n.run()},i=Object.freeze({on:n.on,onKeyUpdate:n.onKeyUpdate.listenSome,getLanguage:n.getLanguage,getPendingLanguage:n.getPendingLanguage,changeLanguage:n.changeLanguage,changeTranslation:n.changeTranslation,addActiveNs:n.addActiveNs,removeActiveNs:n.removeActiveNs,loadRecords:n.loadRecords,loadRecord:n.loadRecord,addStaticData:n.addStaticData,getRecord:n.getRecord,getAllRecords:n.getAllRecords,isLoaded:n.isLoaded,isInitialLoading:n.isInitialLoading,isLoading:n.isLoading,isFetching:n.isFetching,isRunning:n.isRunning,run:n.run,stop:n.stop,t:n.t,highlight:n.highlight,getInitialOptions:n.getInitialOptions,isDev:n.isDev,wrap:n.wrap,unwrap:n.unwrap,setObserverOptions:e=>(n.setObserverOptions(e),i),use:e=>(e&&a((()=>e(i,t))),i),init:e=>(a((()=>n.init(e))),i)});return i},R="data-tolgee-restricted",T="_tolgee",P="_tolgee-highlighter",w="data-tolgee-key-only";var j,C;!function(e){e[e.EMPTY_PARAMETER=0]="EMPTY_PARAMETER",e[e.UNEXPECTED_CHARACTER=1]="UNEXPECTED_CHARACTER",e[e.UNEXPECTED_END=2]="UNEXPECTED_END"}(j||(j={}));class N extends Error{constructor(e,n,t){super(`Tolgee parser: ${j[e]} at ${n} in ${t}`),this.code=e,this.index=n}}function S(e){return/\s/.test(e)}!function(e){e[e.TEXT=0]="TEXT",e[e.ESCAPE_MAYBE=1]="ESCAPE_MAYBE",e[e.ESCAPE=2]="ESCAPE",e[e.PARAM=3]="PARAM",e[e.PARAM_AFTER=4]="PARAM_AFTER"}(C||(C={}));const D=new Set([C.ESCAPE,C.ESCAPE_MAYBE,C.TEXT]),F=new Set(["{","}","'"]);function B(e,n){const[t,a]=function(e){let n=C.TEXT,t="",a="",i="";const o=[],r=[];let s=0;function g(n){throw new N(n,s,e)}const c=()=>{o.push(t),t=""},u=()=>{""===a&&g(j.EMPTY_PARAMETER),r.push(a),a=""};for(s=0;s<e.length;s++)switch(i=e[s],n){case C.TEXT:"'"===i?(t+=i,n=C.ESCAPE_MAYBE):"{"===i?(c(),n=C.PARAM):(t+=i,n=C.TEXT);break;case C.ESCAPE_MAYBE:F.has(i)?(t=t.slice(0,-1)+i,n=C.ESCAPE):(t+=i,n=C.TEXT);break;case C.ESCAPE:"'"===i?n=C.TEXT:(t+=i,n=C.ESCAPE);break;case C.PARAM:"}"===i?(u(),n=C.TEXT):S(i)?(/[0-9a-zA-Z_]/.test(i)||g(j.UNEXPECTED_CHARACTER),a+=i,n=C.PARAM):""!==a&&(u(),n=C.PARAM_AFTER);break;case C.PARAM_AFTER:"}"==i?n=C.TEXT:S(i)?n=C.PARAM_AFTER:g(j.UNEXPECTED_CHARACTER)}return D.has(n)||g(j.UNEXPECTED_END),c(),[o,r]}(e),i=[t[0]];for(let o=1;o<t.length;o++){const r=null==n?void 0:n[a[o-1]];if(void 0===r)throw new Error(`Missing parameter "${a[o-1]}" in "${e}"`);i.push(String(r)),i.push(t[o])}return i.join("")}const I=()=>(e,n)=>(n.setFinalFormatter({format:({translation:e,params:n})=>B(e,n)}),e);export{I as FormatSimple,R as RESTRICTED_ASCENDANT_ATTRIBUTE,T as TOLGEE_ATTRIBUTE_NAME,P as TOLGEE_HIGHLIGHTER_CLASS,w as TOLGEE_WRAPPED_ONLY_DATA_ATTRIBUTE,k as Tolgee,n as getFallback,t as getFallbackArray,L as getTranslateParams};
//# sourceMappingURL=tolgee.esm.min.mjs.map
